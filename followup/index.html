<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Follow-up Activity Form — Matthew Chatbot Creation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            lavender: {
              50: "#F5F3FF", 100: "#EEE8FF", 200: "#E4D9FF", 300: "#D3BFFF",
              400: "#BFA3FF", 500: "#A884FF", 600: "#8F6AF2", 700: "#7756D6",
              800: "#5F46AD", 900: "#4B3788",
            },
          },
          boxShadow: { soft: "0 10px 30px rgba(127, 90, 240, 0.15)" }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { font-family: "Noto Sans Thai", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    .fade-enter { opacity: 0; transform: translateY(8px); }
    .fade-enter-active { opacity: 1; transform: translateY(0); transition: all 280ms ease; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-lavender-50 via-lavender-100 to-lavender-200 text-lavender-900">
  <main class="max-w-3xl mx-auto px-6 py-10 md:py-14">
    <header class="mb-8 md:mb-10 text-center">
      <div class="inline-flex items-center gap-2 rounded-full bg-lavender-200/70 px-4 py-2 text-sm font-semibold text-lavender-800 shadow-soft">
        <span>Follow-up Activity Form</span><span class="text-lavender-700">•</span><span>Matthew AI Bot Creation</span>
      </div>
      <h1 class="mt-5 text-3xl md:text-4xl font-extrabold tracking-tight text-lavender-900">
        Matthew Chatbot Follow Up Form
      </h1>
      <!-- <p class="mt-3 text-lavender-800/90">กรอกข้อมูลทีละข้อ และกดส่ง ระบบจะบันทึกลง Google Sheet ให้ทันที</p> -->
    </header>

    <section class="relative bg-lavender-100/80 rounded-2xl p-5 md:p-7 shadow-soft ring-1 ring-lavender-300/60">
      <div class="mb-6">
        <div class="flex items-center justify-between mb-2">
          <span id="progressText" class="text-sm font-semibold text-lavender-800">ขั้นตอน 1/9</span>
          <span id="progressLabel" class="text-sm text-lavender-800/80">ข้อมูลผู้สอน</span>
        </div>
        <div class="h-2.5 w-full bg-lavender-200 rounded-full overflow-hidden">
          <div id="progressBar" class="h-full bg-gradient-to-r from-lavender-500 to-lavender-700 rounded-full transition-all duration-300" style="width: 11%;"></div>
        </div>
      </div>

      <div id="stepsContainer" class="space-y-6">
        <!-- Step 0 -->
        <div class="step" data-step="0">
          <h2 class="text-xl md:text-2xl font-bold text-lavender-900 mb-1">สวัสดีค่ะอาจารย์</h2>
          <p class="text-lavender-800/90 mb-5">กรอกข้อมูลเบื้องต้นก่อนเริ่มกันเลย</p>
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label for="teacherName" class="block font-semibold text-lavender-900 mb-1.5">ชื่ออาจารย์</label>
              <input id="teacherName" type="text" placeholder="เช่น อ.แมทริว"
                     class="w-full rounded-xl bg-white/60 focus:bg-white border border-lavender-300 focus:border-lavender-600 outline-none px-4 py-3 text-lavender-900 placeholder-lavender-700/50 shadow-sm transition" />
            </div>
            <div>
              <label for="teamName" class="block font-semibold text-lavender-900 mb-1.5">ชื่อทีม/กลุ่ม</label>
              <input id="teamName" type="text" placeholder="เช่น ทีม A หรือ กลุ่ม DataAI"
                     class="w-full rounded-xl bg-white/60 focus:bg-white border border-lavender-300 focus:border-lavender-600 outline-none px-4 py-3 text-lavender-900 placeholder-lavender-700/50 shadow-sm transition" />
            </div>
          </div>
          <div class="mt-6 flex justify-end">
            <button class="nextBtn inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-lavender-700 hover:bg-lavender-800 text-white font-semibold shadow-soft transition">
              ถัดไป <span aria-hidden="true">→</span>
            </button>
          </div>
        </div>

        <!-- Step 1 -->
        <div class="step hidden" data-step="1">
          <h2 class="text-xl md:text-2xl font-bold text-lavender-900 mb-1">อาจารย์กำลังสร้าง Chatbot สำหรับวิชา/หัวข้ออะไร?</h2>
          <p class="text-lavender-800/90 mb-3">ระบุวิชาหรือหัวข้อที่เกี่ยวข้อง</p>
          <textarea id="q1" rows="5" placeholder="เช่น วิชา Data Science หัวข้อ: การทำความสะอาดข้อมูล"
                    class="w-full rounded-xl bg-white/60 focus:bg-white border border-lavender-300 focus:border-lavender-600 outline-none px-4 py-3 text-lavender-900 placeholder-lavender-700/50 shadow-sm transition"></textarea>
          <div class="mt-4 flex items-center justify-between">
            <button class="prevBtn inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/60 hover:bg-white text-lavender-800 font-semibold border border-lavender-300 shadow-sm transition">← ก่อนหน้า</button>
            <button class="nextBtn inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-lavender-700 hover:bg-lavender-800 text-white font-semibold shadow-soft transition">ถัดไป →</button>
          </div>
        </div>

        <!-- Step 2 -->
        <div class="step hidden" data-step="2">
          <h2 class="text-xl md:text-2xl font-bold text-lavender-900 mb-1">อาจารย์ออกแบบให้ Chatbot นี้ทำอะไรได้บ้าง?</h2>
          <p class="text-lavender-800/90 mb-3">ตัวอย่าง: ตอบคำถาม, Quiz, แนะนำ ฯลฯ</p>
          <textarea id="q2" rows="5" placeholder="เช่น ตอบคำถามบทเรียน, ให้แบบทดสอบสั้น, แนะนำแหล่งเรียนรู้"
                    class="w-full rounded-xl bg-white/60 focus:bg-white border border-lavender-300 focus:border-lavender-600 outline-none px-4 py-3 text-lavender-900 placeholder-lavender-700/50 shadow-sm transition"></textarea>
          <div class="mt-4 flex items-center justify-between">
            <button class="prevBtn inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/60 hover:bg-white text-lavender-800 font-semibold border border-lavender-300 shadow-sm transition">← ก่อนหน้า</button>
            <button class="nextBtn inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-lavender-700 hover:bg-lavender-800 text-white font-semibold shadow-soft transition">ถัดไป →</button>
          </div>
        </div>

        <!-- Step 3 -->
        <div class="step hidden" data-step="3">
          <h2 class="text-xl md:text-2xl font-bold text-lavender-900 mb-1">Persona หรือบุคลิกของ Chatbot เป็นแบบไหน?</h2>
          <p class="text-lavender-800/90 mb-3">เช่น ใจดี เป็นมิตร ทางการ ฯลฯ</p>
          <textarea id="q3" rows="5" placeholder="เช่น เป็นมิตร ใช้ภาษาง่าย ให้กำลังใจผู้เรียน"
                    class="w-full rounded-xl bg-white/60 focus:bg-white border border-lavender-300 focus:border-lavender-600 outline-none px-4 py-3 text-lavender-900 placeholder-lavender-700/50 shadow-sm transition"></textarea>
          <div class="mt-4 flex items-center justify-between">
            <button class="prevBtn inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/60 hover:bg-white text-lavender-800 font-semibold border border-lavender-300 shadow-sm transition">← ก่อนหน้า</button>
            <button class="nextBtn inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-lavender-700 hover:bg-lavender-800 text-white font-semibold shadow-soft transition">ถัดไป →</button>
          </div>
        </div>

        <!-- Step 4 -->
        <div class="step hidden" data-step="4">
          <h2 class="text-xl md:text-2xl font-bold text-lavender-900 mb-1">ระหว่างออกแบบ Chatbot และการเขียน Instruction ของ Chatbot มี tip อะไรอยากแชร์ไหมคะ?</h2>
          <p class="text-lavender-800/90 mb-3">tip, ประสบการณ์, ปัญหา, ไอเดีย</p>
          <textarea id="q4" rows="5" placeholder="เช่น เจอปัญหาเรื่องความยาว prompt เลยแยกเป็นข้อ ๆ"
                    class="w-full rounded-xl bg-white/60 focus:bg-white border border-lavender-300 focus:border-lavender-600 outline-none px-4 py-3 text-lavender-900 placeholder-lavender-700/50 shadow-sm transition"></textarea>
          <div class="mt-4 flex items-center justify-between">
            <button class="prevBtn inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/60 hover:bg-white text-lavender-800 font-semibold border border-lavender-300 shadow-sm transition">← ก่อนหน้า</button>
            <button class="nextBtn inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-lavender-700 hover:bg-lavender-800 text-white font-semibold shadow-soft transition">ถัดไป →</button>
          </div>
        </div>

        <!-- Step 5 -->
        <div class="step hidden" data-step="5">
          <h2 class="text-xl md:text-2xl font-bold text-lavender-900 mb-1">ช่วยแชร์ Instruction ของทีมอาจารย์ให้หน่อยค่ะ</h2>
          <textarea id="q5" rows="5" placeholder="เช่น พิมพ์ prompt หลัก + อ้างอิงไฟล์ PDF"
                    class="w-full rounded-xl bg-white/60 focus:bg-white border border-lavender-300 focus:border-lavender-600 outline-none px-4 py-3 text-lavender-900 placeholder-lavender-700/50 shadow-sm transition"></textarea>
          <div class="mt-4 flex items-center justify-between">
            <button class="prevBtn inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/60 hover:bg-white text-lavender-800 font-semibold border border-lavender-300 shadow-sm transition">← ก่อนหน้า</button>
            <button class="nextBtn inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-lavender-700 hover:bg-lavender-800 text-white font-semibold shadow-soft transition">ถัดไป →</button>
          </div>
        </div>

        <!-- Step 6 -->
        <div class="step hidden" data-step="6">
          <h2 class="text-xl md:text-2xl font-bold text-lavender-900 mb-1">ได้ตั้งค่าแบ่งปันหรือ access control ให้ใครบ้างคะ?</h2>
          <p class="text-lavender-800/90 mb-3">ใส่ Email ของคนที่อาจารย์ให้ access</p>
          <textarea id="q6" rows="5" placeholder="เช่น เปิดให้เฉพาะอีเมลโดเมนมหาวิทยาลัย"
                    class="w-full rounded-xl bg-white/60 focus:bg-white border border-lavender-300 focus:border-lavender-600 outline-none px-4 py-3 text-lavender-900 placeholder-lavender-700/50 shadow-sm transition"></textarea>
          <div class="mt-4 flex items-center justify-between">
            <button class="prevBtn inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/60 hover:bg-white text-lavender-800 font-semibold border border-lavender-300 shadow-sm transition">← ก่อนหน้า</button>
            <button class="nextBtn inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-lavender-700 hover:bg-lavender-800 text-white font-semibold shadow-soft transition">ถัดไป →</button>
          </div>
        </div>

        <!-- Step 7 -->
        <div class="step hidden" data-step="7">
          <h2 class="text-xl md:text-2xl font-bold text-lavender-900 mb-1">เห็นแนวทางการนำ Chatbot ไปใช้ในคลาสเรียนในอนาคตอย่างไรบ้างคะ?</h2>
          <p class="text-lavender-800/90 mb-3">แชร์ภาพรวมการที่อาจารย์จะเอาใช้งานในชั้นเรียนในอนาคต</p>
          <textarea id="q7" rows="5" placeholder="เช่น ใช้เป็นผู้ช่วยตอบคำถามระหว่างทำงานกลุ่ม"
                    class="w-full rounded-xl bg-white/60 focus:bg-white border border-lavender-300 focus:border-lavender-600 outline-none px-4 py-3 text-lavender-900 placeholder-lavender-700/50 shadow-sm transition"></textarea>
          <div class="mt-4 flex items-center justify-between">
            <button class="prevBtn inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/60 hover:bg-white text-lavender-800 font-semibold border border-lavender-300 shadow-sm transition">← ก่อนหน้า</button>
            <button class="nextBtn inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-lavender-700 hover:bg-lavender-800 text-white font-semibold shadow-soft transition">ถัดไป →</button>
          </div>
        </div>

        <!-- Step 8 -->
        <div class="step hidden" data-step="8">
          <h2 class="text-xl md:text-2xl font-bold text-lavender-900 mb-1">เย้! เสร็จแล้ว รู้สึกอย่างไร หรือมีข้อเสนอแนะไหม?</h2>
          <p class="text-lavender-800/90 mb-3">บอกความรู้สึกหรือสิ่งที่อยากให้ปรับปรุง</p>
          <textarea id="q8" rows="5" placeholder="เช่น สนุกและได้แนวคิดใหม่ ๆ อยากให้มีตัวอย่างเพิ่ม"
                    class="w-full rounded-xl bg-white/60 focus:bg-white border border-lavender-300 focus:border-lavender-600 outline-none px-4 py-3 text-lavender-900 placeholder-lavender-700/50 shadow-sm transition"></textarea>
          <div class="mt-4 flex items-center justify-between">
            <button class="prevBtn inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/60 hover:bg-white text-lavender-800 font-semibold border border-lavender-300 shadow-sm transition">← ก่อนหน้า</button>
            <button id="submitBtn" class="inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-gradient-to-r from-lavender-700 to-lavender-800 hover:from-lavender-800 hover:to-lavender-900 text-white font-semibold shadow-soft transition">
              ส่งแบบฟอร์ม <span aria-hidden="true">📮</span>
            </button>
          </div>
        </div>
      </div>
    </section>

    <footer class="max-w-3xl mx-auto text-center mt-8 text-sm text-lavender-800/80">
      <p class="mt-1">
        Google Sheet:
        <a class="underline decoration-lavender-600 hover:text-lavender-900" target="_blank" href="https://docs.google.com/spreadsheets/d/1bpMOuW25DIUljCDyRVQyzxYSeZFJeQ3Hqhb3Oq9VUdU/edit?usp=sharing">เปิดสเปรดชีต</a>
      </p>
    </footer>
  </main>

  <script>
    // Replace with the PUBLIC URL (no `/a/macros/...`)
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzw94NXqACUGS5lQOqlkLigN0yBvx_U3xtni7dB6p3R07WZovY44njlYlU3rtYJsIp8/exec";
                    //"https://script.google.com/macros/s/AKfycbxCCG2f-CPcdyXSNuLuXs4YU9sklWsVY2grocUY4cfnoNSkMVwcwwcUpb66C9c_xAaH/exec"
                    //https://script.google.com/macros/s/AKfycbzw94NXqACUGS5lQOqlkLigN0yBvx_U3xtni7dB6p3R07WZovY44njlYlU3rtYJsIp8/exec
    const steps = Array.from(document.querySelectorAll(".step"));
    const totalSteps = steps.length;
    let current = 0;

    const progressText = document.getElementById("progressText");
    const progressLabel = document.getElementById("progressLabel");
    const progressBar = document.getElementById("progressBar");

    const stepLabels = [
      "ข้อมูลผู้สอน","วิชา/หัวข้อ","ความสามารถของบอท","บุคลิกของบอท",
      "ประสบการณ์/ปัญหา/ไอเดีย","วิธีใส่ Instruction","การตั้งค่าสิทธิ์เข้าถึง",
      "ได้ตั้งค่าสิทธิ์ให้ใครบ้าง","ความรู้สึก/ข้อเสนอแนะ"
    ];

    function updateProgress() {
      progressText.textContent = `ขั้นตอน ${current + 1}/${totalSteps}`;
      progressLabel.textContent = stepLabels[current] || "";
      const percent = Math.round(((current + 1) / totalSteps) * 100);
      progressBar.style.width = percent + "%";
    }

    function showStep(index) {
      steps.forEach((el) => el.classList.add("hidden"));
      const target = steps[index];
      if (target) {
        target.classList.remove("hidden");
        target.classList.add("fade-enter");
        requestAnimationFrame(() => {
          target.classList.add("fade-enter-active");
          setTimeout(() => target.classList.remove("fade-enter", "fade-enter-active"), 300);
        });
      }
      updateProgress();
    }

    function validateStep(idx) {
      if (idx === 0) {
        const teacher = document.getElementById("teacherName").value.trim();
        const team = document.getElementById("teamName").value.trim();
        if (!teacher || !team) {
          Swal.fire({ icon: "warning", title: "กรอกข้อมูลให้ครบ", text: "กรุณากรอกชื่ออาจารย์และชื่อทีม/กลุ่ม" });
          return false;
        }
        return true;
      }
      const textarea = document.querySelector(`.step[data-step="${idx}"] textarea`);
      if (!textarea || !textarea.value.trim()) {
        Swal.fire({ icon: "warning", title: "ยังไม่ได้กรอก", text: "กรุณากรอกคำตอบก่อนกดถัดไป" });
        return false;
      }
      return true;
    }

    function collectData() {
      return {
        teacherName: document.getElementById("teacherName").value.trim(),
        teamName: document.getElementById("teamName").value.trim(),
        q1: document.getElementById("q1").value.trim(),
        q2: document.getElementById("q2").value.trim(),
        q3: document.getElementById("q3").value.trim(),
        q4: document.getElementById("q4").value.trim(),
        q5: document.getElementById("q5").value.trim(),
        q6: document.getElementById("q6").value.trim(),
        q7: document.getElementById("q7").value.trim(),
        q8: document.getElementById("q8").value.trim()
      };
    }

    function submitJSONP(payload) {
      const submitBtn = document.getElementById("submitBtn");
      if (submitBtn) { submitBtn.disabled = true; submitBtn.classList.add("opacity-70","cursor-not-allowed"); }

      Swal.fire({
        title: "กำลังบันทึก...", text: "โปรดรอสักครู่",
        allowOutsideClick: false, didOpen: () => Swal.showLoading(),
      });

      const cbName = "cb_" + Date.now() + "_" + Math.random().toString(36).slice(2);
      const script = document.createElement("script");
      script.async = true;
      let timeoutHandle;

      window[cbName] = function(response) {
        clearTimeout(timeoutHandle);
        cleanup();
        if (response && (response.ok || response.status === "success")) {
          Swal.fire({ icon: "success", title: "บันทึกสำเร็จ!", text: "ข้อมูลถูกบันทึกลง Google Sheet แล้ว" })
            .then(() => showThankYou());
        } else {
          Swal.fire({ icon: "error", title: "บันทึกไม่สำเร็จ", text: (response && response.message) ? response.message : "ลองใหม่อีกครั้ง" });
          if (submitBtn) { submitBtn.disabled = false; submitBtn.classList.remove("opacity-70","cursor-not-allowed"); }
        }
      };

      function cleanup() {
        try {
          if (script && script.parentNode) script.parentNode.removeChild(script);
          delete window[cbName];
        } catch (e) {}
      }

      script.onerror = function() {
        clearTimeout(timeoutHandle);
        cleanup();
        Swal.fire({
          icon: "error",
          title: "เชื่อมต่อไม่ได้",
          text: "ตรวจสอบ URL ของ Web App (ต้องเป็นแบบ /macros/s/..), และสถานะการเผยแพร่ (Anyone)",
        });
        if (submitBtn) { submitBtn.disabled = false; submitBtn.classList.remove("opacity-70","cursor-not-allowed"); }
      };

      timeoutHandle = setTimeout(() => {
        cleanup();
        Swal.fire({ icon: "error", title: "หมดเวลาเชื่อมต่อ", text: "อาจยังไม่ได้เผยแพร่ Web App หรือ URL ไม่ถูกต้อง" });
        if (submitBtn) { submitBtn.disabled = false; submitBtn.classList.remove("opacity-70","cursor-not-allowed"); }
      }, 15000);

      const dataStr = encodeURIComponent(JSON.stringify(payload));
      script.src = `${GAS_URL}?callback=${cbName}&data=${dataStr}&t=${Date.now()}`;
      document.body.appendChild(script);
    }

    function showThankYou() {
      document.querySelector("main").innerHTML = `
        <section class="min-h-[70vh] flex items-center justify-center">
          <div class="text-center bg-lavender-100/80 rounded-2xl p-8 md:p-12 shadow-soft ring-1 ring-lavender-300/60">
            <div class="inline-flex items-center justify-center w-14 h-14 rounded-full bg-lavender-700 text-white text-2xl shadow-soft">✓</div>
            <h2 class="mt-5 text-3xl font-extrabold text-lavender-900">ขอบคุณค่ะ</h2>
            <p class="mt-2 text-lavender-800/90">ระบบได้รับข้อมูลของอาจารย์เรียบร้อยแล้ว</p>
            <button id="againBtn" class="mt-6 inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-lavender-700 hover:bg-lavender-800 text-white font-semibold shadow-soft transition">กรอกอีกครั้ง</button>
          </div>
        </section>`;
      document.getElementById("againBtn").addEventListener("click", () => location.reload());
    }

    document.querySelectorAll(".nextBtn").forEach(btn => {
      btn.addEventListener("click", () => {
        if (!validateStep(current)) return;
        if (current < totalSteps - 1) { current += 1; showStep(current); }
      });
    });

    document.querySelectorAll(".prevBtn").forEach(btn => {
      btn.addEventListener("click", () => {
        if (current > 0) { current -= 1; showStep(current); }
      });
    });

    document.getElementById("submitBtn").addEventListener("click", () => {
      if (!validateStep(current)) return;
      const data = collectData();
      submitJSONP(data);
    });

    showStep(current);
  </script>
</body>
</html>
